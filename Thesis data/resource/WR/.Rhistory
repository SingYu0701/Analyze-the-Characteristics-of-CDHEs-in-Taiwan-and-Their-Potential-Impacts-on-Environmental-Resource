# 4. Âª∫Á´ãÁµêÊûúË≥áÊñôÊ°Ü
results <- data.frame(System=character(),
Effect=character(),
Correlation=numeric(),
stringsAsFactors = FALSE)
# 5. ÈÄêÁµÑÂêàË®àÁÆó point-biserial correlation
for(sys in systems){
# Áï∂Âπ¥‰∫ã‰ª∂ √ó Áï∂Âπ¥ÂÅèÂ∑Æ
idx <- !is.na(data[[paste0(sys, " (%)")]]) & !is.na(data$Event_t)
r1 <- pointbiserial.cor(data[[paste0(sys, " (%)")]][idx],
data$Event_t[idx])
results <- rbind(results,
data.frame(System=sys,
Effect="Áï∂Âπ¥‰∫ã‰ª∂ √ó Áï∂Âπ¥ÂÅèÂ∑Æ",
Correlation=r1))
# Ââç‰∏ÄÂπ¥‰∫ã‰ª∂ √ó Áï∂Âπ¥ÂÅèÂ∑Æ
idx <- !is.na(data[[paste0(sys, " (%)")]]) & !is.na(data$Event_t1)
r2 <- pointbiserial.cor(data[[paste0(sys, " (%)")]][idx],
data$Event_t1[idx])
results <- rbind(results,
data.frame(System=sys,
Effect="Ââç‰∏ÄÂπ¥‰∫ã‰ª∂ √ó Áï∂Âπ¥ÂÅèÂ∑Æ",
Correlation=r2))
# Áï∂Âπ¥‰∫ã‰ª∂ √ó Âπ¥ËÆäÂåñ
idx <- !is.na(data[[paste0(sys, " vs prev yr (%)")]]) & !is.na(data$Event_t)
r3 <- pointbiserial.cor(data[[paste0(sys, " vs prev yr (%)")]][idx],
data$Event_t[idx])
results <- rbind(results,
data.frame(System=sys,
Effect="Áï∂Âπ¥‰∫ã‰ª∂ √ó Âπ¥ËÆäÂåñ",
Correlation=r3))
# Ââç‰∏ÄÂπ¥‰∫ã‰ª∂ √ó Âπ¥ËÆäÂåñ
idx <- !is.na(data[[paste0(sys, " vs prev yr (%)")]]) & !is.na(data$Event_t1)
r4 <- pointbiserial.cor(data[[paste0(sys, " vs prev yr (%)")]][idx],
data$Event_t1[idx])
results <- rbind(results,
data.frame(System=sys,
Effect="Ââç‰∏ÄÂπ¥‰∫ã‰ª∂ √ó Âπ¥ËÆäÂåñ",
Correlation=r4))
}
# 1. ËÆÄÂèñË≥áÊñô
file_path <- "D:/ÊàêÂ§ß/Ë≥áÊ∫êÊâÄ/SPI+HWDI/data/resource/south_resource.xlsx"
data <- read_excel(file_path)
# 2. Âª∫Á´ã‰∫ã‰ª∂ËÆäÊï∏
data <- data %>%
mutate(
Event_t  = ifelse(`Compound event` %in% c("Y"), 1, 0),
Event_t1 = lag(Event_t, 1) # Ââç‰∏ÄÂπ¥‰∫ã‰ª∂ t-1
) %>%
arrange(Year)
# 3. Á≥ªÁµ±ÂêçÁ®±
systems <- c("Reservoir", "Rice", "Aquaculture", "Electricity", "Heat-related cases")
# 4. Âª∫Á´ãÁµêÊûúË≥áÊñôÊ°Ü
results <- data.frame(System=character(),
Effect=character(),
Correlation=numeric(),
stringsAsFactors = FALSE)
# 5. ÈÄêÁµÑÂêàË®àÁÆó point-biserial correlation
for(sys in systems){
# Áï∂Âπ¥‰∫ã‰ª∂ √ó Áï∂Âπ¥ÂÅèÂ∑Æ
idx <- !is.na(data[[paste0(sys, " (%)")]]) & !is.na(data$Event_t)
r1 <- biserial.cor(data[[paste0(sys, " (%)")]][idx],
data$Event_t[idx],
use = "complete.obs",
correct = FALSE)
results <- rbind(results,
data.frame(System=sys,
Effect="Áï∂Âπ¥‰∫ã‰ª∂ √ó Áï∂Âπ¥ÂÅèÂ∑Æ",
Correlation=r1))
# Ââç‰∏ÄÂπ¥‰∫ã‰ª∂ √ó Áï∂Âπ¥ÂÅèÂ∑Æ
idx <- !is.na(data[[paste0(sys, " (%)")]]) & !is.na(data$Event_t1)
r2 <- biserial.cor(data[[paste0(sys, " (%)")]][idx],
data$Event_t1[idx],
use = "complete.obs",
correct = FALSE)
results <- rbind(results,
data.frame(System=sys,
Effect="Ââç‰∏ÄÂπ¥‰∫ã‰ª∂ √ó Áï∂Âπ¥ÂÅèÂ∑Æ",
Correlation=r2))
# Áï∂Âπ¥‰∫ã‰ª∂ √ó Âπ¥ËÆäÂåñ
idx <- !is.na(data[[paste0(sys, " vs prev yr (%)")]]) & !is.na(data$Event_t)
r3 <- biserial.cor(data[[paste0(sys, " vs prev yr (%)")]][idx],
data$Event_t[idx],
use = "complete.obs",
correct = FALSE)
results <- rbind(results,
data.frame(System=sys,
Effect="Áï∂Âπ¥‰∫ã‰ª∂ √ó Âπ¥ËÆäÂåñ",
Correlation=r3))
# Ââç‰∏ÄÂπ¥‰∫ã‰ª∂ √ó Âπ¥ËÆäÂåñ
idx <- !is.na(data[[paste0(sys, " vs prev yr (%)")]]) & !is.na(data$Event_t1)
r4 <- biserial.cor(data[[paste0(sys, " vs prev yr (%)")]][idx],
data$Event_t1[idx],
use = "complete.obs",
correct = FALSE)
results <- rbind(results,
data.frame(System=sys,
Effect="Ââç‰∏ÄÂπ¥‰∫ã‰ª∂ √ó Âπ¥ËÆäÂåñ",
Correlation=r4))
}
x <- c(0.659, -3.335, -1.287, -6.110, 2.642, 0.351, 0.856, -0.468, 2.999, 5.590, 5.443, 2.658, -9.997)
# ‰∫åÂÖÉ‰∫ã‰ª∂ (0 = N, 1 = Y)
y <- c(0,1,0,1,1,1,0,0,1,1,0,1,0)
# Âπ≥ÂùáÂÄº
mean_y1 <- mean(x[y==1])  # Áï∂‰∫ã‰ª∂ÁôºÁîü
mean_y0 <- mean(x[y==0])  # Áï∂‰∫ã‰ª∂Êú™ÁôºÁîü
# Pearson Áõ∏ÈóúÔºàÁõ¥Êé•Áï∂‰ΩúÈªû‰∫åÂàóÁõ∏ÈóúÔºâ
r_pearson <- cor(x, y, method = "pearson")
# biserial() Ë®àÁÆóÔºàÊΩõÂú®ÈÄ£Á∫åÂÅáË®≠Ôºâ
r_biserial <- biserial(x, y, use = "complete.obs", correct = TRUE)
library(readxl)
library(dplyr)
library(tidyr)
library(ggplot2)
library(psych)
library(scales)# Áî®‰æÜË®àÁÆó point-biserial correlation
# 1. ËÆÄÂèñË≥áÊñô
file_path <- "D:/ÊàêÂ§ß/Ë≥áÊ∫êÊâÄ/SPI+HWDI/data/resource/south_resource.xlsx"
data <- read_excel(file_path)
# 2. Âª∫Á´ã‰∫ã‰ª∂ËÆäÊï∏
data <- data %>%
mutate(
Event_t  = ifelse(`Compound event` %in% c("Y"), 1, 0),
Event_t1 = lag(Event_t, 1) # Ââç‰∏ÄÂπ¥‰∫ã‰ª∂ t-1
) %>%
arrange(Year)
# 3. Á≥ªÁµ±ÂêçÁ®±
systems <- c("Reservoir", "Rice", "Aquaculture", "Electricity", "Heat-related cases")
# 4. Âª∫Á´ãÁµêÊûúË≥áÊñôÊ°Ü
results <- data.frame(System=character(),
Effect=character(),
Correlation=numeric(),
stringsAsFactors = FALSE)
# 5. ÈÄêÁµÑÂêàË®àÁÆó point-biserial correlation
for(sys in systems){
# Áï∂Âπ¥‰∫ã‰ª∂ √ó Áï∂Âπ¥ÂÅèÂ∑Æ
idx <- !is.na(data[[paste0(sys, " (%)")]]) & !is.na(data$Event_t)
r1 <- biserial(data[[paste0(sys, " (%)")]][idx],
data$Event_t[idx])
results <- rbind(results,
data.frame(System=sys,
Effect="Áï∂Âπ¥‰∫ã‰ª∂ √ó Áï∂Âπ¥ÂÅèÂ∑Æ",
Correlation=r1))
# Ââç‰∏ÄÂπ¥‰∫ã‰ª∂ √ó Áï∂Âπ¥ÂÅèÂ∑Æ
idx <- !is.na(data[[paste0(sys, " (%)")]]) & !is.na(data$Event_t1)
r2 <- biserial(data[[paste0(sys, " (%)")]][idx],
data$Event_t1[idx])
results <- rbind(results,
data.frame(System=sys,
Effect="Ââç‰∏ÄÂπ¥‰∫ã‰ª∂ √ó Áï∂Âπ¥ÂÅèÂ∑Æ",
Correlation=r2))
# Áï∂Âπ¥‰∫ã‰ª∂ √ó Âπ¥ËÆäÂåñ
idx <- !is.na(data[[paste0(sys, " vs prev yr (%)")]]) & !is.na(data$Event_t)
r3 <- biserial(data[[paste0(sys, " vs prev yr (%)")]][idx],
data$Event_t[idx])
results <- rbind(results,
data.frame(System=sys,
Effect="Áï∂Âπ¥‰∫ã‰ª∂ √ó Âπ¥ËÆäÂåñ",
Correlation=r3))
# Ââç‰∏ÄÂπ¥‰∫ã‰ª∂ √ó Âπ¥ËÆäÂåñ
idx <- !is.na(data[[paste0(sys, " vs prev yr (%)")]]) & !is.na(data$Event_t1)
r4 <- biserial(data[[paste0(sys, " vs prev yr (%)")]][idx],
data$Event_t1[idx])
results <- rbind(results,
data.frame(System=sys,
Effect="Ââç‰∏ÄÂπ¥‰∫ã‰ª∂ √ó Âπ¥ËÆäÂåñ",
Correlation=r4))
}
# 6. È°ØÁ§∫ÁµêÊûú
print(results)
results_selected2 <- results %>%
filter(
(System == "Reservoir" & Effect %in% c("Ââç‰∏ÄÂπ¥‰∫ã‰ª∂ √ó Âπ¥ËÆäÂåñ")) |
(System == "Rice" & Effect == "Ââç‰∏ÄÂπ¥‰∫ã‰ª∂ √ó Âπ¥ËÆäÂåñ") |
(System == "Aquaculture" & Effect %in% c("Ââç‰∏ÄÂπ¥‰∫ã‰ª∂ √ó Áï∂Âπ¥ÂÅèÂ∑Æ","Áï∂Âπ¥‰∫ã‰ª∂ √ó Áï∂Âπ¥ÂÅèÂ∑Æ")) |
(System == "Electricity" & Effect == "Ââç‰∏ÄÂπ¥‰∫ã‰ª∂ √ó Áï∂Âπ¥ÂÅèÂ∑Æ") |
(System == "Heat-related cases" & Effect == "Áï∂Âπ¥‰∫ã‰ª∂ √ó Âπ¥ËÆäÂåñ")
) %>%
mutate(Effect_Type = ifelse(grepl("Ââç‰∏ÄÂπ¥", Effect), "lag", "current"))
ggplot(results_selected2, aes(x = reorder(System, Correlation), y = Correlation, fill = Effect_Type)) +
geom_col(width = 0.5, position = position_dodge(width = 0.6)) +  # üîπ Êü±Â≠êËÆäÁ¥∞
geom_text(
aes(label = round(Correlation, 3)),
position = position_dodge(width = 0.6),
hjust = -0.1, size = 3.5
) +
coord_flip() +
ylab("Correlation") +
xlab("System") +
ggtitle("(b) Effects of Compound Drought‚ÄìHeat Events on Resource Systems in Hengchun") +
scale_fill_manual(values = c("lag" = "#6A6AFF", "current" = "#2894FF")) +
theme_minimal() +
theme(
plot.title = element_text(hjust = 0.5, face = "bold", size = 12),
axis.title = element_text(size = 10, face = "bold"),
axis.text.x = element_text(size = 10),
axis.text.y = element_text(size = 10, angle = 20, hjust = 1),
legend.title = element_text(size = 10, face = "bold"),
legend.text = element_text(size = 10),
legend.key.size = unit(1.2, "lines"),
legend.position = c(0.9, 0.1),
legend.background = element_rect(fill = alpha("white", 0.5), color = NA)
)
"lag" = "#6A6AFF", "current" = "#2894FF"
View(data)
ggplot(results_selected2, aes(x = reorder(System, Correlation), y = Correlation, fill = Effect_Type)) +
geom_col(width = 0.5, position = position_dodge(width = 0.6)) +  # üîπ Êü±Â≠êËÆäÁ¥∞
geom_text(
aes(label = round(Correlation, 3)),
position = position_dodge(width = 0.6),
hjust = -0.1, size = 3.5
) +
coord_flip() +
ylab("Correlation") +
xlab("System") +
ggtitle("(b) Effects of Compound Drought‚ÄìHeat Events on Resource Systems in Hengchun") +
scale_fill_manual(values = c("lag" = "orange", "current" = "red")) +
theme_minimal() +
theme(
plot.title = element_text(hjust = 0.5, face = "bold", size = 12),
axis.title = element_text(size = 10, face = "bold"),
axis.text.x = element_text(size = 10),
axis.text.y = element_text(size = 10, angle = 20, hjust = 1),
legend.title = element_text(size = 10, face = "bold"),
legend.text = element_text(size = 10),
legend.key.size = unit(1.2, "lines"),
legend.position = c(0.9, 0.1),
legend.background = element_rect(fill = alpha("white", 0.5), color = NA)
)
library(readxl)
library(dplyr)
library(tidyr)
library(ggplot2)
library(psych)
library(scales)# Áî®‰æÜË®àÁÆó point-biserial correlation
# 1. ËÆÄÂèñË≥áÊñô
file_path <- "D:/ÊàêÂ§ß/Ë≥áÊ∫êÊâÄ/SPI+HWDI/data/resource/north_resource.xlsx"
data <- read_excel(file_path)
# 2. Âª∫Á´ã‰∫ã‰ª∂ËÆäÊï∏
data <- data %>%
mutate(
Event_t  = ifelse(`Compound event` %in% c("Y"), 1, 0),
Event_t1 = lag(Event_t, 1) # Ââç‰∏ÄÂπ¥‰∫ã‰ª∂ t-1
) %>%
arrange(Year)
# 3. Á≥ªÁµ±ÂêçÁ®±
systems <- c("Reservoir", "Rice", "Aquaculture", "Electricity", "Heat-related cases")
# 4. Âª∫Á´ãÁµêÊûúË≥áÊñôÊ°Ü
results <- data.frame(System=character(),
Effect=character(),
Correlation=numeric(),
stringsAsFactors = FALSE)
# 5. ÈÄêÁµÑÂêàË®àÁÆó point-biserial correlation
for(sys in systems){
# Áï∂Âπ¥‰∫ã‰ª∂ √ó Áï∂Âπ¥ÂÅèÂ∑Æ
idx <- !is.na(data[[paste0(sys, " (%)")]]) & !is.na(data$Event_t)
r1 <- biserial(data[[paste0(sys, " (%)")]][idx],
data$Event_t[idx])
results <- rbind(results,
data.frame(System=sys,
Effect="Áï∂Âπ¥‰∫ã‰ª∂ √ó Áï∂Âπ¥ÂÅèÂ∑Æ",
Correlation=r1))
# Ââç‰∏ÄÂπ¥‰∫ã‰ª∂ √ó Áï∂Âπ¥ÂÅèÂ∑Æ
idx <- !is.na(data[[paste0(sys, " (%)")]]) & !is.na(data$Event_t1)
r2 <- biserial(data[[paste0(sys, " (%)")]][idx],
data$Event_t1[idx])
results <- rbind(results,
data.frame(System=sys,
Effect="Ââç‰∏ÄÂπ¥‰∫ã‰ª∂ √ó Áï∂Âπ¥ÂÅèÂ∑Æ",
Correlation=r2))
# Áï∂Âπ¥‰∫ã‰ª∂ √ó Âπ¥ËÆäÂåñ
idx <- !is.na(data[[paste0(sys, " vs prev yr (%)")]]) & !is.na(data$Event_t)
r3 <- biserial(data[[paste0(sys, " vs prev yr (%)")]][idx],
data$Event_t[idx])
results <- rbind(results,
data.frame(System=sys,
Effect="Áï∂Âπ¥‰∫ã‰ª∂ √ó Âπ¥ËÆäÂåñ",
Correlation=r3))
# Ââç‰∏ÄÂπ¥‰∫ã‰ª∂ √ó Âπ¥ËÆäÂåñ
idx <- !is.na(data[[paste0(sys, " vs prev yr (%)")]]) & !is.na(data$Event_t1)
r4 <- biserial(data[[paste0(sys, " vs prev yr (%)")]][idx],
data$Event_t1[idx])
results <- rbind(results,
data.frame(System=sys,
Effect="Ââç‰∏ÄÂπ¥‰∫ã‰ª∂ √ó Âπ¥ËÆäÂåñ",
Correlation=r4))
}
# 6. È°ØÁ§∫ÁµêÊûú
print(results)
results_selected2 <- results %>%
filter(
(System == "Reservoir" & Effect %in% c("Ââç‰∏ÄÂπ¥‰∫ã‰ª∂ √ó Âπ¥ËÆäÂåñ")) |
(System == "Rice" & Effect == "Ââç‰∏ÄÂπ¥‰∫ã‰ª∂ √ó Âπ¥ËÆäÂåñ") |
(System == "Aquaculture" & Effect %in% c("Ââç‰∏ÄÂπ¥‰∫ã‰ª∂ √ó Âπ¥ËÆäÂåñ","Áï∂Âπ¥‰∫ã‰ª∂ √ó Âπ¥ËÆäÂåñ")) |
(System == "Electricity" & Effect == "Ââç‰∏ÄÂπ¥‰∫ã‰ª∂ √ó Âπ¥ËÆäÂåñ") |
(System == "Heat-related cases" & Effect == "Ââç‰∏ÄÂπ¥‰∫ã‰ª∂ √ó Âπ¥ËÆäÂåñ")
) %>%
mutate(Effect_Type = ifelse(grepl("Ââç‰∏ÄÂπ¥", Effect), "lag", "current"))
ggplot(results_selected2, aes(x = reorder(System, Correlation), y = Correlation, fill = Effect_Type)) +
geom_col(width = 0.5, position = position_dodge(width = 0.6)) +  # üîπ Êü±Â≠êËÆäÁ¥∞
geom_text(
aes(label = round(Correlation, 3)),
position = position_dodge(width = 0.6),
hjust = -0.1, size = 3.5
) +
coord_flip() +
ylab("Correlation") +
xlab("System") +
ggtitle("(a) Effects of Compound Drought‚ÄìHeat Events on Resource Systems in Keelung") +
scale_fill_manual(values = c("lag" = "#6A6AFF", "current" = "#2894FF")) +
theme_minimal() +
theme(
plot.title = element_text(hjust = 0.5, face = "bold", size = 12),
axis.title = element_text(size = 10, face = "bold"),
axis.text.x = element_text(size = 10),
axis.text.y = element_text(size = 10, angle = 20, hjust = 1),
legend.title = element_text(size = 10, face = "bold"),
legend.text = element_text(size = 10),
legend.key.size = unit(1.2, "lines"),
legend.position = c(0.9, 0.1),
legend.background = element_rect(fill = alpha("white", 0.5), color = NA)
)
ggplot(results_selected2, aes(x = reorder(System, Correlation), y = Correlation, fill = Effect_Type)) +
geom_col(width = 0.5, position = position_dodge(width = 0.6)) +  # üîπ Êü±Â≠êËÆäÁ¥∞
geom_text(
aes(label = round(Correlation, 3)),
position = position_dodge(width = 0.6),
hjust = -0.1, size = 3.5
) +
coord_flip() +
ylab("Correlation") +
xlab("System") +
ggtitle("(a) Effects of Compound Drought‚ÄìHeat Events on Resource Systems in Keelung") +
scale_fill_manual(values = c("lag" = "#6A6AFF", "current" = "#2894FF")) +
theme_minimal() +
theme(
plot.title = element_text(hjust = 0.5, face = "bold", size = 12),
axis.title = element_text(size = 10, face = "bold"),
axis.text.x = element_text(size = 10),
axis.text.y = element_text(size = 12, angle = 20, hjust = 1),
legend.title = element_text(size = 10, face = "bold"),
legend.text = element_text(size = 10),
legend.key.size = unit(1.2, "lines"),
legend.position = c(0.9, 0.1),
legend.background = element_rect(fill = alpha("white", 0.5), color = NA)
)
ggplot(results_selected2, aes(x = reorder(System, Correlation), y = Correlation, fill = Effect_Type)) +
geom_col(width = 0.5, position = position_dodge(width = 0.6)) +  # üîπ Êü±Â≠êËÆäÁ¥∞
geom_text(
aes(label = round(Correlation, 3)),
position = position_dodge(width = 0.6),
hjust = -0.1, size = 3.5
) +
coord_flip() +
ylab("Correlation") +
xlab("System") +
ggtitle("(a) Effects of Compound Drought‚ÄìHeat Events on Resource Systems in Keelung") +
scale_fill_manual(values = c("lag" = "#6A6AFF", "current" = "#2894FF")) +
theme_minimal() +
theme(
plot.title = element_text(hjust = 0.5, face = "bold", size = 12),
axis.title = element_text(size = 10, face = "bold"),
axis.text.x = element_text(size = 10),
axis.text.y = element_text(size = 14, angle = 20, hjust = 1),
legend.title = element_text(size = 10, face = "bold"),
legend.text = element_text(size = 10),
legend.key.size = unit(1.2, "lines"),
legend.position = c(0.9, 0.1),
legend.background = element_rect(fill = alpha("white", 0.5), color = NA)
)
ggplot(results_selected2, aes(x = reorder(System, Correlation), y = Correlation, fill = Effect_Type)) +
geom_col(width = 0.5, position = position_dodge(width = 0.6)) +  # üîπ Êü±Â≠êËÆäÁ¥∞
geom_text(
aes(label = round(Correlation, 3)),
position = position_dodge(width = 0.6),
hjust = -0.1, size = 3.5
) +
coord_flip() +
ylab("Correlation") +
xlab("System") +
ggtitle("(a) Effects of Compound Drought‚ÄìHeat Events on Resource Systems in Keelung") +
scale_fill_manual(values = c("lag" = "orange", "current" = "red")) +
theme_minimal() +
theme(
plot.title = element_text(hjust = 0.5, face = "bold", size = 12),
axis.title = element_text(size = 10, face = "bold"),
axis.text.x = element_text(size = 10),
axis.text.y = element_text(size = 14, angle = 20, hjust = 1),
legend.title = element_text(size = 10, face = "bold"),
legend.text = element_text(size = 10),
legend.key.size = unit(1.2, "lines"),
legend.position = c(0.9, 0.1),
legend.background = element_rect(fill = alpha("white", 0.5), color = NA)
)
library(readxl)
library(dplyr)
library(tidyr)
library(ggplot2)
library(psych)
library(scales)# Áî®‰æÜË®àÁÆó point-biserial correlation
# 1. ËÆÄÂèñË≥áÊñô
file_path <- "D:/ÊàêÂ§ß/Ë≥áÊ∫êÊâÄ/SPI+HWDI/data/resource/south_resource.xlsx"
data <- read_excel(file_path)
# 2. Âª∫Á´ã‰∫ã‰ª∂ËÆäÊï∏
data <- data %>%
mutate(
Event_t  = ifelse(`Compound event` %in% c("Y"), 1, 0),
Event_t1 = lag(Event_t, 1) # Ââç‰∏ÄÂπ¥‰∫ã‰ª∂ t-1
) %>%
arrange(Year)
# 3. Á≥ªÁµ±ÂêçÁ®±
systems <- c("Reservoir", "Rice", "Aquaculture", "Electricity", "Heat-related cases")
# 4. Âª∫Á´ãÁµêÊûúË≥áÊñôÊ°Ü
results <- data.frame(System=character(),
Effect=character(),
Correlation=numeric(),
stringsAsFactors = FALSE)
# 5. ÈÄêÁµÑÂêàË®àÁÆó point-biserial correlation
for(sys in systems){
# Áï∂Âπ¥‰∫ã‰ª∂ √ó Áï∂Âπ¥ÂÅèÂ∑Æ
idx <- !is.na(data[[paste0(sys, " (%)")]]) & !is.na(data$Event_t)
r1 <- biserial(data[[paste0(sys, " (%)")]][idx],
data$Event_t[idx])
results <- rbind(results,
data.frame(System=sys,
Effect="Áï∂Âπ¥‰∫ã‰ª∂ √ó Áï∂Âπ¥ÂÅèÂ∑Æ",
Correlation=r1))
# Ââç‰∏ÄÂπ¥‰∫ã‰ª∂ √ó Áï∂Âπ¥ÂÅèÂ∑Æ
idx <- !is.na(data[[paste0(sys, " (%)")]]) & !is.na(data$Event_t1)
r2 <- biserial(data[[paste0(sys, " (%)")]][idx],
data$Event_t1[idx])
results <- rbind(results,
data.frame(System=sys,
Effect="Ââç‰∏ÄÂπ¥‰∫ã‰ª∂ √ó Áï∂Âπ¥ÂÅèÂ∑Æ",
Correlation=r2))
# Áï∂Âπ¥‰∫ã‰ª∂ √ó Âπ¥ËÆäÂåñ
idx <- !is.na(data[[paste0(sys, " vs prev yr (%)")]]) & !is.na(data$Event_t)
r3 <- biserial(data[[paste0(sys, " vs prev yr (%)")]][idx],
data$Event_t[idx])
results <- rbind(results,
data.frame(System=sys,
Effect="Áï∂Âπ¥‰∫ã‰ª∂ √ó Âπ¥ËÆäÂåñ",
Correlation=r3))
# Ââç‰∏ÄÂπ¥‰∫ã‰ª∂ √ó Âπ¥ËÆäÂåñ
idx <- !is.na(data[[paste0(sys, " vs prev yr (%)")]]) & !is.na(data$Event_t1)
r4 <- biserial(data[[paste0(sys, " vs prev yr (%)")]][idx],
data$Event_t1[idx])
results <- rbind(results,
data.frame(System=sys,
Effect="Ââç‰∏ÄÂπ¥‰∫ã‰ª∂ √ó Âπ¥ËÆäÂåñ",
Correlation=r4))
}
# 6. È°ØÁ§∫ÁµêÊûú
print(results)
results_selected2 <- results %>%
filter(
(System == "Reservoir" & Effect %in% c("Ââç‰∏ÄÂπ¥‰∫ã‰ª∂ √ó Âπ¥ËÆäÂåñ")) |
(System == "Rice" & Effect == "Ââç‰∏ÄÂπ¥‰∫ã‰ª∂ √ó Âπ¥ËÆäÂåñ") |
(System == "Aquaculture" & Effect %in% c("Ââç‰∏ÄÂπ¥‰∫ã‰ª∂ √ó Áï∂Âπ¥ÂÅèÂ∑Æ","Áï∂Âπ¥‰∫ã‰ª∂ √ó Áï∂Âπ¥ÂÅèÂ∑Æ")) |
(System == "Electricity" & Effect == "Ââç‰∏ÄÂπ¥‰∫ã‰ª∂ √ó Áï∂Âπ¥ÂÅèÂ∑Æ") |
(System == "Heat-related cases" & Effect == "Áï∂Âπ¥‰∫ã‰ª∂ √ó Âπ¥ËÆäÂåñ")
) %>%
mutate(Effect_Type = ifelse(grepl("Ââç‰∏ÄÂπ¥", Effect), "lag", "current"))
ggplot(results_selected2, aes(x = reorder(System, Correlation), y = Correlation, fill = Effect_Type)) +
geom_col(width = 0.5, position = position_dodge(width = 0.6)) +  # üîπ Êü±Â≠êËÆäÁ¥∞
geom_text(
aes(label = round(Correlation, 3)),
position = position_dodge(width = 0.6),
hjust = -0.1, size = 3.5
) +
coord_flip() +
ylab("Correlation") +
xlab("System") +
ggtitle("(b) Effects of Compound Drought‚ÄìHeat Events on Resource Systems in Hengchun") +
scale_fill_manual(values = c("lag" = "orange", "current" = "red")) +
theme_minimal() +
theme(
plot.title = element_text(hjust = 0.5, face = "bold", size = 12),
axis.title = element_text(size = 10, face = "bold"),
axis.text.x = element_text(size = 10),
axis.text.y = element_text(size = 14, angle = 20, hjust = 1),
legend.title = element_text(size = 10, face = "bold"),
legend.text = element_text(size = 10),
legend.key.size = unit(1.2, "lines"),
legend.position = c(0.9, 0.1),
legend.background = element_rect(fill = alpha("white", 0.5), color = NA)
)
"lag" = "#6A6AFF", "current" = "#2894FF"
ggplot(results_selected2, aes(x = reorder(System, Correlation), y = Correlation, fill = Effect_Type)) +
geom_col(width = 0.5, position = position_dodge(width = 0.6)) +  # üîπ Êü±Â≠êËÆäÁ¥∞
geom_text(
aes(label = round(Correlation, 3)),
position = position_dodge(width = 0.6),
hjust = -0.1, size = 3.5
) +
coord_flip() +
ylab("Correlation") +
xlab("System") +
ggtitle("(b) Effects of Compound Drought‚ÄìHeat Events on Resource Systems in Hengchun") +
scale_fill_manual(values = c("lag" = "#6A6AFF", "current" = "#2894FF")) +
theme_minimal() +
theme(
plot.title = element_text(hjust = 0.5, face = "bold", size = 12),
axis.title = element_text(size = 10, face = "bold"),
axis.text.x = element_text(size = 10),
axis.text.y = element_text(size = 14, angle = 20, hjust = 1),
legend.title = element_text(size = 10, face = "bold"),
legend.text = element_text(size = 10),
legend.key.size = unit(1.2, "lines"),
legend.position = c(0.9, 0.1),
legend.background = element_rect(fill = alpha("white", 0.5), color = NA)
)
